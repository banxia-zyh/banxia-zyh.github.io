(window.webpackJsonp=window.webpackJsonp||[]).push([[17],{502:function(s,t,a){"use strict";a.r(t);var n=a(4),e=Object(n.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("blockquote",[a("p",[s._v("为什么需要性能分析插件？")])]),s._v(" "),a("ul",[a("li",[s._v("因为我们在平时开发中会遇到"),a("strong",[s._v("慢sql")]),s._v("的问题，基于此MyBatis Plus就提供了性能分析插件，超过这个时间就停止运行。")])]),s._v(" "),a("blockquote",[a("p",[s._v("Mybatisplus3.2.0以上就不支持本身的性能分析插件（PerformceInterceptor），支持p6spy组件")])]),s._v(" "),a("ul",[a("li",[s._v("下面就p6spy进行分析")])]),s._v(" "),a("blockquote",[a("p",[s._v("1、倒入相应的依赖")])]),s._v(" "),a("div",{staticClass:"language-xml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-xml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("\x3c!--p6spy--\x3e")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("dependency")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("groupId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("p6spy"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("groupId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("artifactId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("p6spy"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("artifactId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("version")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("3.9.1"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("version")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("dependency")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("blockquote",[a("p",[s._v("2、编写配置文件")])]),s._v(" "),a("ul",[a("li",[s._v("关键点1：url需要加上p6spy 固定的是"),a("strong",[s._v("jdbc:p6spy:数据库名")]),s._v("…")]),s._v(" "),a("li",[s._v("关键点2：driver-class-name指定的是p6spy的驱动")])]),s._v(" "),a("div",{staticClass:"language-properties line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-properties"}},[a("code",[a("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("spring.datasource.username")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("root")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("spring.datasource.password")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("root")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("spring.datasource.url")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("jdbc:p6spy:mysql://localhost:3306/mybatis_plus")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("spring.datasource.driver-class-name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("com.p6spy.engine.spy.P6SpyDriver")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("blockquote",[a("p",[s._v("3、编写p6spy的核心配置文件spy.properties")])]),s._v(" "),a("div",{staticClass:"language-properties line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-properties"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#3.2.1以上使用")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("modulelist")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("com.baomidou.mybatisplus.extension.p6spy.MybatisPlusLogFactory,com.p6spy.engine.outage.P6OutageFactory")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#3.2.1以下使用或者不配置")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#modulelist=com.p6spy.engine.logging.P6LogFactory,com.p6spy.engine.outage.P6OutageFactory")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 自定义日志打印")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("logMessageFormat")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("com.baomidou.mybatisplus.extension.p6spy.P6SpyLogger")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#日志输出到控制台")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("appender")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("com.baomidou.mybatisplus.extension.p6spy.StdoutLogger")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 使用日志系统记录 sql")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#appender=com.p6spy.engine.spy.appender.Slf4JLogger")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置 p6spy driver 代理")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("deregisterdrivers")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("true")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 取消JDBC URL前缀")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("useprefix")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("true")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置记录 Log 例外,可去掉的结果集有error,info,batch,debug,statement,commit,rollback,result,resultset.")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("excludecategories")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("info,debug,result,commit,resultset")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 日期格式")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("dateformat")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("yyyy-MM-dd HH:mm:ss")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 实际驱动可多个")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#driverlist=org.h2.Driver")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 是否开启慢SQL记录")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("outagedetection")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("true")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 慢SQL记录标准 2 秒")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("outagedetectioninterval")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("2")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br")])]),a("blockquote",[a("p",[s._v("4、运行测试方法并得到结果")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/banxia-zyh/img/img/image-20210323232943284.png",alt:"123"}})]),s._v(" "),a("blockquote",[a("p",[a("strong",[s._v("注意！")])]),s._v(" "),a("ul",[a("li",[s._v("driver-class-name 为 p6spy 提供的驱动类")]),s._v(" "),a("li",[s._v("url 前缀为 jdbc:p6spy 跟着冒号为对应数据库连接地址")]),s._v(" "),a("li",[s._v("打印出sql为null,在excludecategories增加commit")]),s._v(" "),a("li",[s._v("批量操作不打印sql,去除excludecategories中的batch")]),s._v(" "),a("li",[s._v("批量操作打印重复的问题请使用MybatisPlusLogFactory (3.2.1新增）")]),s._v(" "),a("li",[s._v("该插件有性能损耗，不建议生产环境使用。")])])])])}),[],!1,null,null,null);t.default=e.exports}}]);